/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,V,aa,O,ba,s,D,e,t){function B(){}function E(c){c?x(ca,c):E.prefs=ca=B.prototype=x({},Q);return this}function I(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function y(c){return c&&
c.getContext?c.getContext("2d"):e}function L(c,a,b){b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();a.restore();b.mask&&(b.autosave&&(a.save(),c=J(c),c.transforms.mask=s,c.savedTransforms=x({},c.transforms)),a.clip())}function da(c,a,b){a._toRad=a.inDegrees?C/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function ea(c,a,b){1!==a.scale&&(a.scaleX=
a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function fa(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function H(c,a,b,f){a._toRad=a.inDegrees?C/180:1;c.save();f===t&&(f=b);!a.fromCenter&&!a._centered&&(a.x+=b/2,a.y+=f/2,a._centered=s);a.rotate&&da(c,a,{});(1!==a.scale||1!==a.scaleX||1!==a.scaleY)&&ea(c,a,{});
(a.translate||a.translateX||a.translateY)&&fa(c,a,{})}function W(c){c.draggable&&(c.translateX+=c.x,c.translateY+=c.y)}function J(c){var a;F.canvas===c?a=F.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,mask:D}},a.savedTransforms=x({},a.transforms),d.data(c,"jCanvas",a)),F.canvas=c,F.data=a);return a}function ga(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function G(c,
a,b,f){var i,g,z="function"===typeof b,A,b=b||{};a._args=b;if(b.layer&&!b._layer){i=d(c);a=i.getLayers();z&&(b={method:d.fn.draw,fn:b});b=x(new B,b);if(!z){b.method=d.fn[b.method]||f;A=J(c);for(g in E.events)E.events.hasOwnProperty(g)&&b[g]&&(g=X(g),E.events[g](i,A),b._event=s);if(b.draggable||b.cursor){b._event=s;c=["mousedown","mousemove","mouseup"];for(f=0;f<c.length;f+=1)g=X(c[f]),E.events[g](i,A);A.mouseout||(i.bind("mouseout.jCanvas",function(){A.drag={};i.drawLayers()}),A.mouseout=s)}}b.layer=
s;b._layer=s;b.index===t&&(b.index=a.length);a.splice(b.index,0,b)}return b}function ha(c){var a;for(a=0;a<N.length;a+=1)c[N[a]]=c["_"+N[a]]}function ia(c,a){var b;for(b=0;b<N.length;b+=1)c["_"+N[b]]=c[N[b]],Y[N[b]]=1,a&&delete c[N[b]]}function ja(c){var a,b,f=[],i=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=V.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(f=c.match(/\d+/gi),c.match(/%/gi)&&(i=2.55),f[0]*=i,f[1]*=i,f[2]*=i,f[3]=f[3]!==
t?ba(f[3]):1);return f}function ma(c){var a=3,b;"object"!==typeof c.start&&(c.start=ja(c.start),c.end=ja(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=R(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function X(c){"ontouchstart"in window&&Z[c]&&(c=Z[c]);return c}function M(c){E.events[c]=
function(a,b){c=X(c);var f="mouseover"===c||"mouseout"===c?"mousemove":c,i=b.event;b[f]||(a.bind(f+".jCanvas",function(b){i.x=b.offsetX;i.y=b.offsetY;i.type=f;i.event=b;a.drawLayers(s);b.preventDefault()}),b[f]=s)}}function K(c,a,b){var f,i,g,d,b=b._args;b._event&&(c=J(c),f=c.event,a=a.isPointInPath(f.x,f.y),i=c.transforms,b.eventX=b.mouseX=f.x,b.eventY=b.mouseY=f.y,b.event=f.event,d=c.transforms.rotate,f=b.eventX,g=b.eventY,b._eventX=f*P(-d)-g*S(-d),b._eventY=g*P(-d)+f*S(-d),b._eventX/=i.scaleX,
b._eventY/=i.scaleY,!a&&(b._hovered&&!b._fired)&&(b._mousedout=s),a&&c.intersects.push(b))}function T(c,a,b,f,i){a.save();a.beginPath();a.rect(f[0],i[0],f[1]-f[0],i[1]-i[0]);a.clip();H(a,b,0);a.beginPath()}function U(c,a,b){b._event&&K(c,a,b);a.restore();L(c,a,b)}function ka(c,a,b,f,i){var g=/\b(\d*\.?\d*)\w\w\b/gi,z;if(F.text===f.text&&F.font===f.font&&F.maxWidth===f.maxWidth&&F.lineHeight===f.lineHeight)f.width=F.width,f.height=F.height;else if(!a){f.width=b.measureText(i[0]).width;for(a=1;a<i.length;a+=
1)z=b.measureText(i[a]).width,z>f.width&&(f.width=z);b=c.style.fontSize;if(a=f.font.match(g))c.style.fontSize=f.font.match(g)[0];f.height=ba(d.css(c,"fontSize"))*i.length*f.lineHeight;c.style.fontSize=b}}var Q,ca,x=d.extend,R=O.round,C=O.PI,S=O.sin,P=O.cos,na=d.event.fix,Z,$,la,F={},N,Y;d.fn.jCanvas=E;E.events={};Q={align:"center",autosave:s,baseline:"middle",bringToFront:D,ccw:D,closed:D,compositing:"source-over",cornerRadius:0,cropFromCenter:s,disableDrag:D,disableEvents:D,domain:e,draggable:D,
each:e,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:s,fn:e,graph:"y",height:e,inDegrees:s,lineHeight:1,load:e,mask:D,maxWidth:e,method:e,miterLimit:10,opacity:1,projection:0,r1:e,r2:e,radius:0,range:e,repeat:"repeat",rotate:0,rounded:D,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:e,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:e,sx:e,sy:e,text:"",translate:0,translateX:0,
translateY:0,type:e,visible:s,width:e,x:0,y:0};E();E.extend=function(c){E.defaults=Q=x(Q,c.props);E();c.name&&(d.fn[c.name]=function b(f){var i,g,d,A=x(new B,f);for(g=0;g<this.length;g+=1)if(i=this[g],d=y(i))f=G(i,A,f,b),I(d,A),c.fn.call(i,d,A);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:J(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),f,i;if(c&&c.layer)f=c;else if("number"===b)f=a[c];else for(i=0;i<a.length;i+=1)if(a[i].index=
i,a[i].name===c||"regexp"===b&&a[i].name.match(c)){f=a[i];break}return f};d.fn.setLayer=function(c,a){var b,f;for(b=0;b<this.length;b+=1)(f=d(this[b]).getLayer(c))&&x(f,a);return this};d.fn.moveLayer=function(c,a){var b,f,i;for(f=0;f<this.length;f+=1)if(b=d(this[f]),i=b.getLayers(),b=b.getLayer(c))i.splice(b.index,1),i.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,f;for(b=0;b<this.length;b+=1)a=d(this[b]),f=a.getLayers(),(a=a.getLayer(c))&&f.splice(a.index,1);return this};
d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),b=d.type(c),f=[],i;if("array"===b)return c;for(i=0;i<a.length;i+=1)a[i].index=i,(a[i].group===c||"regexp"===b&&a[i].group.match(c))&&f.push(a[i]);return f};d.fn.setLayerGroup=function(c,a){var b,f,i;for(f=0;f<this.length;f+=1){b=d(this[f]);b=b.getLayerGroup(c);for(i=0;i<b.length;i+=1)x(b[i],a)}return this};d.fn.removeLayerGroup=function(c){var a,
b,f=d.type(c),i;if(c!==t)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(i=0;i<a.length;i+=1)if(a[i].index=i,a[i].group===c||"regexp"===f&&a[i].group.match(c))a.splice(i,1),i-=1}return this};d.fn.drawLayer=function(c){var a,b,f,i;for(a=0;a<this.length;a+=1)f=d(this[a]),b=y(this[a]),i=f.getLayer(c),ga(f,b,i);return this};d.fn.drawLayers=function(c){var a,b,f,i,g,z,A,o,u;for(b=0;b<this.length;b+=1)if(a=d(this[b]),f=y(this[b])){J(this[b]);a.clearCanvas();F.canvas===this[b]?A=F.data:(A=J(this[b]),
F.canvas=this[b],F.data=A);i=A.layers;for(z=0;z<i.length;z+=1)if(g=i[z],g.index=z,c&&(g._fired=D),g._event=!g.disableEvents,ga(a,f,g),g._mousedout)g._mousedout=D,g._fired=s,g._hovered=D,g.mouseout&&g.mouseout.call(this[b],g),g.cursor&&g._cursor&&a.css({cursor:g._cursor});g=A.intersects[A.intersects.length-1]||{};f=A.event;z=f.type;g[z]||$[z]&&(z=$[z]);u=g[z];o=A.drag;if(g._event){if((g.mouseover||g.mouseout||g.cursor)&&!g._hovered&&!g._fired)g._fired=s,g._hovered=s,g.mouseover&&g.mouseover.call(this[b],
g),g.cursor&&(g._cursor=a.css("cursor"),a.css({cursor:g.cursor}));u&&!g._fired&&(g._fired=s,u.call(this[b],g),f.type=e);if(g.draggable&&!g.disableDrag&&("mousedown"===z||"touchstart"===z))g.bringToFront&&(i.splice(g.index,1),g.index=i.push(g)),o.layer=g,o.dragging=s,o.startX=g.x,o.startY=g.y,o.endX=g._eventX,o.endY=g._eventY,g.dragstart&&g.dragstart.call(this[b],g)}if(o.layer){if(o.dragging&&("mouseup"===z||"touchend"===z))o.layer.dragstop&&o.layer.dragstop.call(this[b],o.layer),A.drag={};if(o.dragging&&
("mousemove"===z||"touchmove"===z))o.layer.x=o.layer._eventX-(o.endX-o.startX),o.layer.y=o.layer._eventY-(o.endY-o.startY),o.layer.drag&&o.layer.drag.call(this[b],o.layer)}}A.intersects=[];return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=y(this[a]))c.layer=s,c.type&&!c.method&&(c.method=d.fn[la[c.type]]),c=G(this[a],{},c,c.method);return this};N=["width","height","opacity","lineHeight"];Y={};d.fn.animateLayer=function(){function c(a,b){return function(){ha(b);
a.drawLayers();g[4]&&g[4].call(a[0],b)}}function a(a,b){return function(c,f){ha(b);a.drawLayers();g[5]&&g[5].call(a[0],c,f,b)}}var b,f,i,g=[].slice.call(arguments,0);"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,0,g[2].duration||e),g.splice(3,0,g[3].easing||e),g.splice(4,0,g[4].complete||e),g.splice(5,0,g[5].step||e)):(g[2]===t?(g.splice(2,0,e),g.splice(3,0,e),g.splice(4,0,e)):"function"===typeof g[2]&&(g.splice(2,0,e),g.splice(3,0,e)),g[3]===t)?(g[3]=e,g.splice(4,
0,e)):"function"===typeof g[3]&&g.splice(3,0,e);g[1]=x({},g[1]);for(f=0;f<this.length;f+=1)if(b=d(this[f]),i=y(this[f]))if(J(this[f]),(i=b.getLayer(g[0]))&&i.method!==d.fn.draw)ia(i),ia(g[1],s),i.style=Y,d(i).animate(g[1],{duration:g[2],easing:d.easing[g[3]]?g[3]:e,complete:c(b,i),step:a(b,i)});return this};d.fn.animateLayerGroup=function(c){var a,b,f=[].slice.call(arguments,0),i,g;for(b=0;b<this.length;b+=1){a=d(this[b]);i=a.getLayerGroup(c);for(g=0;g<i.length;g+=1)a.animateLayer.apply(a,[i[g]].concat(f.slice(1)))}};
d.fn.delayLayer=function(c,a){var b,f,a=a||0;for(b=0;b<this.length;b+=1)f=d(this[b]).getLayer(c),d(f).delay(a);return this};d.fn.delayLayerGroup=function(c,a){var b,f,i,g,a=a||0;for(f=0;f<this.length;f+=1){b=d(this[f]);i=b.getLayerGroup(c);for(g=0;g<i.length;g+=1)b.delayLayer.call(b,i[g],a)}};d.fn.stopLayer=function(c,a){var b,f;for(b=0;b<this.length;b+=1)f=d(this[b]).getLayer(c),d(f).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,f,i,g;for(f=0;f<this.length;f+=1){b=d(this[f]);i=b.getLayerGroup(c);
for(g=0;g<i.length;g+=1)b.stopLayer.call(b,i[g],a)}};(function(c){var a;for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=ma})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));Z={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};$={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};M("click");M("dblclick");M("mousedown");M("mouseup");M("mousemove");M("mouseover");M("mouseout");
M("touchstart");M("touchmove");M("touchend");d.event.fix=function(c){var a,b,c=na.call(d.event,c);if(a=c.originalEvent)if(b=a.changedTouches,c.pageX!==t&&c.offsetX===t){if(a=d(c.target).offset())c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top}else if(b&&(a=d(a.target).offset()))c.offsetX=b[0].pageX-a.left,c.offsetY=b[0].pageY-a.top;return c};la={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",
rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function a(b){var f,i,b=b||{};"function"===typeof b&&(b={fn:b});for(f=0;f<this.length;f+=1)if((i=y(this[f]))&&b.fn)b=G(this[f],{},b,a),b.fn.call(this[f],i);return this};d.fn.clearCanvas=function(a){for(var b,f=x(new B,a),a=0;a<this.length;a+=1)if(b=y(this[a]))H(b,f,f.width,f.height),b.setTransform(1,0,0,1,0,0),!f.x||!f.y||!f.width||!f.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(f.x-f.width/2,f.y-f.height/2,f.width,
f.height),b.restore();return this};d.fn.saveCanvas=function(){var a,b,f;for(a=0;a<this.length;a+=1)if(b=y(this[a]))f=J(this[a]),b.save(),f.savedTransforms=x({},f.transforms);return this};d.fn.restoreCanvas=function(){var a,b,f;for(a=0;a<this.length;a+=1)if(b=y(this[a]))f=J(this[a]),b.restore(),f.transforms=x({},f.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=function(){return this.draw({layer:s,fn:function(){d(this).restoreCanvas()}})};d.fn.translateCanvas=function(a){for(var b,f=x(new B,
a),i,a=0;a<this.length;a+=1)if(b=y(this[a]))i=J(this[a]),f.autosave&&b.save(),fa(b,f,i.transforms);return this};d.fn.scaleCanvas=function(a){for(var b,f=x(new B,a),i,a=0;a<this.length;a+=1)if(b=y(this[a]))i=J(this[a]),f.autosave&&b.save(),ea(b,f,i.transforms);return this};d.fn.rotateCanvas=function(a){for(var b,f=x(new B,a),i,a=0;a<this.length;a+=1)if(b=y(this[a]))i=J(this[a]),f.autosave&&b.save(),da(b,f,i.transforms);return this};d.fn.drawRect=function b(f){var i,g,d=x(new B,f),e,o,u,w,r;for(i=0;i<
this.length;i+=1)if(g=y(this[i]))f=G(this[i],d,f,b),I(g,d),H(g,d,d.width,d.height),g.beginPath(),e=d.x-d.width/2,o=d.y-d.height/2,(r=d.cornerRadius)?(d.closed=s,u=d.x+d.width/2,w=d.y+d.height/2,0>u-e-2*r&&(r=(u-e)/2),0>w-o-2*r&&(r=(w-o)/2),g.moveTo(e+r,o),g.lineTo(u-r,o),g.arc(u-r,o+r,r,3*C/2,2*C,D),g.lineTo(u,w-r),g.arc(u-r,w-r,r,0,C/2,D),g.lineTo(e+r,w),g.arc(e+r,w-r,r,C/2,C,D),g.lineTo(e,o+r),g.arc(e+r,o+r,r,C,3*C/2,D)):g.rect(e,o,d.width,d.height),d._event&&K(this[i],g,d),L(this[i],g,d);return this};
d.fn.drawArc=function f(i){var g,d,e=x(new B,i),i=i||{};!e.inDegrees&&360===e.end&&(i.end=e.end=2*C);for(g=0;g<this.length;g+=1)if(d=y(this[g]))i=G(this[g],e,i,f),I(d,e),H(d,e,2*e.radius),d.beginPath(),d.arc(e.x,e.y,e.radius,e.start*e._toRad-C/2,e.end*e._toRad-C/2,e.ccw),e._event&&K(this[g],d,e),L(this[g],d,e);return this};d.fn.drawEllipse=function i(g){var d,e,o=x(new B,g),u=4*o.width/3,w=o.height;o.closed=s;for(d=0;d<this.length;d+=1)if(e=y(this[d]))g=G(this[d],o,g,i),I(e,o),H(e,o,o.width,o.height),
e.beginPath(),e.moveTo(o.x,o.y-w/2),e.bezierCurveTo(o.x-u/2,o.y-w/2,o.x-u/2,o.y+w/2,o.x,o.y+w/2),e.bezierCurveTo(o.x+u/2,o.y+w/2,o.x+u/2,o.y-w/2,o.x,o.y-w/2),o._event&&K(this[d],e,o),L(this[d],e,o);return this};d.fn.drawPolygon=function g(d){var e,o,u=x(new B,d),w=2*C/u.sides,r=C/u.sides,p=r+C/2,n=u.radius*P(w/2),j,k,m;d.closed=u.closed=s;for(e=0;e<this.length;e+=1)if(o=y(this[e])){d=G(this[e],u,d,g);I(o,u);H(o,u,2*u.radius);o.beginPath();for(m=0;m<u.sides;m+=1)j=u.x+R(u.radius*P(p)),k=u.y+R(u.radius*
S(p)),o.lineTo(j,k),u.projection&&(j=u.x+R((n+n*u.projection)*P(p+r)),k=u.y+R((n+n*u.projection)*S(p+r)),o.lineTo(j,k)),p+=w;u._event&&K(this[e],o,u);L(this[e],o,u)}return this};d.fn.drawLine=function z(d){var e,u,w=x(new B,d),r,p,n;for(e=0;e<this.length;e+=1)if(u=y(this[e])){d=G(this[e],w,d,z);I(u,w);W(w);H(u,w,0);r=1;for(u.beginPath();s;)if(p=w["x"+r],n=w["y"+r],p!==t&&n!==t)u.lineTo(p,n),r+=1;else break;w._event&&K(this[e],u,w);L(this[e],u,w)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function A(d){var e,
w,r=x(new B,d),p,n,j,k,m;for(e=0;e<this.length;e+=1)if(w=y(this[e])){d=G(this[e],r,d,A);I(w,r);W(r);H(w,r,0);p=2;w.beginPath();for(w.moveTo(r.x1,r.y1);s;)if(n=r["x"+p],j=r["y"+p],k=r["cx"+(p-1)],m=r["cy"+(p-1)],n!==t&&j!==t&&k!==t&&m!==t)w.quadraticCurveTo(k,m,n,j),p+=1;else break;r._event&&K(this[e],w,r);L(this[e],w,r)}return this};d.fn.drawBezier=function o(d){var e,r,p=x(new B,d),n,j,k,m,q,l,h,v;for(e=0;e<this.length;e+=1)if(r=y(this[e])){d=G(this[e],p,d,o);I(r,p);W(p);H(r,p,0);n=2;j=1;r.beginPath();
for(r.moveTo(p.x1,p.y1);s;)if(k=p["x"+n],m=p["y"+n],q=p["cx"+j],l=p["cy"+j],h=p["cx"+(j+1)],v=p["cy"+(j+1)],k!==t&&m!==t&&q!==t&&l!==t&&h!==t&&v!==t)r.bezierCurveTo(q,l,h,v,k,m),n+=1,j+=2;else break;p._event&&K(this[e],r,p);L(this[e],r,p)}return this};d.fn.drawVector=function u(d){var e,p,n=x(new B,d),j,k,m,q,l;for(e=0;e<this.length;e+=1)if(p=y(this[e])){d=G(this[e],n,d,u);I(p,n);H(p,n,0);j=1;p.beginPath();q=n.x;l=n.y;for(p.moveTo(n.x,n.y);s;)if(k=n["a"+j],m=n["l"+j],k!==t&&m!==t)k=k*n._toRad-C/2,
q+=m*O.cos(k),l+=m*O.sin(k),p.lineTo(q,l),j+=1;else break;n._event&&K(this[e],p,n);L(this[e],p,n)}return this};d.fn.drawGraph=function w(d){var p,n,j=x(new B,d),k,m,q,l,h;for(p=0;p<this.length;p+=1)if((n=y(this[p]))&&j.fn){d=G(this[p],j,d,w);I(n,j);k=j.graph;m=j.domain;q=j.range;l=this[p].width;h=this[p].height;m===e&&(m=[e,e]);m[0]===e&&(m[0]=0);m[1]===e&&(m[1]=l);q===e&&(q=[e,e]);q[0]===e&&(q[0]=0);q[1]===e&&(q[1]=h);T(p,n,j,m,q);if("y"===k)for(k=m[0]-j.x;k<=m[1]-j.x;k+=1)h=j.fn(k),h===e?(U(this[p],
n,j),T(p,n,j,m,q)):n.lineTo(k+j.x,h+j.y);else if("x"===k)for(h=q[0]-j.y;h<=q[1]-j.y;h+=1)k=j.fn(h),k===e?(U(this[p],n,j),T(p,n,j,m,q)):n.lineTo(k+j.x,h+j.y);else if("r"===k)for(l=0;l<2*C;l+=C/180)h=j.fn(l),k=h*P(l),h*=S(l),k===e||h===e?(U(this[p],n,j),T(n,j,m,q)):n.lineTo(k+j.x,h+j.y);U(this[p],n,j)}};d.fn.drawText=function r(p){var n,j,k=x(new B,p),m,q,l,h;for(n=0;n<this.length;n+=1)if(d(this[n]),j=y(this[n])){p=G(this[n],k,p,r);I(j,k);j.textBaseline=k.baseline;j.textAlign=k.align;j.font=k.font;
if(!n&&k.maxWidth!==e){m=j;q=k.text;h=k.maxWidth;var v=k.text.split(" "),s=[],t="";if(m.measureText(q).width<h||1===v.length)s=[q];else for(;0<v.length;)m.measureText(v[0]).width>h||m.measureText(t+v[0]).width<h?t+=v.shift()+" ":(s.push(t),t=""),0===v.length&&s.push(t);m=s;m=m.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else n||(m=(""+k.text).split("\n"));ka(this[n],n,j,k,m);H(j,k,k.width,k.height);n||(l=k.x,"left"===k.align?l-=k.width/2:"right"===k.align&&(l+=k.width/2));for(q=0;q<m.length;q+=
1)j.shadowColor=k.shadowColor,h=k.y+q*k.height/m.length-(m.length-1)*k.height/m.length/2,j.fillText(m[q],l,h),"transparent"!==k.fillStyle&&(j.shadowColor="transparent"),j.strokeText(m[q],l,h);k._event?(j.beginPath(),j.rect(k.x-k.width/2,k.y-k.height/2,k.width,k.height),j.restore(),K(this[n],j,k),j.closePath()):j.restore()}F=k;return this};d.fn.measureText=function(d){var e;e=d!==t&&"object"!==typeof d?this.getLayer(d):x(new B,d);(d=y(this[0]))&&e.text!==t&&ka(this[0],0,d,e,e.text.split("\n"));return e};
d.fn.drawImage=function p(d){function j(p,j,l){return function(){j||((t=v.width/v.height,h.width===e&&h.sWidth===e&&(d.width=h.width=h.sWidth=v.width),h.height===e&&h.sHeight===e&&(d.height=h.height=h.sHeight=v.height),h.width===e&&h.sWidth!==e&&(h.width=h.sWidth),h.height===e&&h.sHeight!==e&&(h.height=h.sHeight),h.sWidth===e&&h.width!==e&&(d.sWidth=h.sWidth=v.width),h.sHeight===e&&h.height!==e&&(d.sHeight=h.sHeight=v.height),h.sx===e&&(h.sx=h.cropFromCenter?v.width/2:0),h.sy===e&&(h.sy=h.cropFromCenter?
v.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>v.width&&(h.sx=v.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>v.height&&(h.sy=v.height-h.sHeight/2),h.width!==e&&h.height===e)?d.height=h.height=h.width/t:h.width===e&&h.height!==e?d.width=h.width=h.height*t:h.width===e&&h.height===e&&(d.width=h.width=v.width,d.height=h.height=v.height));H(l,h,h.width,h.height);l.drawImage(v,h.sx-h.sWidth/2,h.sy-h.sHeight/
2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);l.fillStyle="transparent";l.beginPath();l.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event&&K(k[j],l,h);L(k[j],l,h);h.load&&h.load.call(p,d)}}var k=this,m,q,l,h=x(new B,d),v,s,t;s=h.source.getContext;h.source.src||s?(v=h.source,h.width=v.width,h.height=v.height):h.source&&(v=new aa,v.src=h.source);for(q=0;q<k.length;q+=1)if(m=k[q],l=y(k[q]))d=G(k[q],h,d,p),I(l,h),v&&(v.complete||s?j(m,q,l)():(v.onload=j(m,q,l),v.src=v.src));
return k};d.fn.createPattern=d.fn.pattern=function(d){function n(){l=k.createPattern(q,m.repeat);m.load&&m.load.call(j[0],l)}var j=this,k,m=x(new B,d),q,l;(k=y(j[0]))?"function"===typeof m.source?(q=V.createElement("canvas"),q.width=m.width,q.height=m.height,d=y(q),m.source.call(q,d),n()):(d=m.source.getContext,m.source.src||d?q=m.source:(q=new aa,q.src=m.source),q.complete||d?n():q.onload=n):l=e;return l};d.fn.createGradient=d.fn.gradient=function(d){var n,d=x(new B,d),j=[],k,m,q,l,h,v,s;if(n=y(this[0])){d.x1=
d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;n=d.r1!==e||d.r2!==e?n.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):n.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(l=1;d["c"+l]!==t;l+=1)d["s"+l]!==t?j.push(d["s"+l]):j.push(e);k=j.length;j[0]===e&&(j[0]=0);j[k-1]===e&&(j[k-1]=1);for(l=0;l<k;l+=1){if(j[l]!==e){v=1;s=0;m=j[l];for(h=l+1;h<k;h+=1)if(j[h]!==e){q=j[h];break}else v+=1;m>q&&(j[h]=j[l])}else j[l]===e&&(s+=1,j[l]=m+s*((q-m)/v));n.addColorStop(j[l],d["c"+(l+1)])}}else n=e;return n};d.fn.setPixels=
function n(d){var e,m,q,l=x(new B,d),h={},v,s,t,C;for(m=0;m<this.length;m+=1)if(e=this[m],q=y(e)){d=G(this[m],l,d,n);H(q,l,l.width,l.height);if(!l.x||!l.y||!l.width||!l.height)l.width=e.width,l.height=e.height,l.x=l.width/2,l.y=l.height/2;v=q.getImageData(l.x-l.width/2,l.y-l.height/2,l.width,l.height);s=v.data;C=s.length;h=[];if(l.each)for(t=0;t<C;t+=4)h.r=s[t],h.g=s[t+1],h.b=s[t+2],h.a=s[t+3],l.each.call(e,h),s[t]=h.r,s[t+1]=h.g,s[t+2]=h.b,s[t+3]=h.a;q.putImageData(v,l.x-l.width/2,l.y-l.height/2);
q.restore()}return this};d.fn.getCanvasImage=function(d,j){var k=this[0];return k&&k.toDataURL?k.toDataURL("image/"+d,j):e};d.support.canvas=V.createElement("canvas").getContext!==t;E.defaults=Q;E.detectEvents=K;E.closePath=L;d.jCanvas=E})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
